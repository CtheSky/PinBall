<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Title</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/site.css">
</head>
<body>
    <canvas id="canvas" width="950" height="700"></canvas>
    <div id="generator" class="panel panel-default">
        <div class="panel-heading">
            <div class="input-group">
                <span class="input-group-addon">Construct blocks & Start game</span>
                <input id="start" type="button" class="form-control" value="Go!">
            </div>
        </div>
        <div class="panel-body">
            <div class="input-group">
                <select id="input-block-type" class="form-control">
                    <option>Static Rectangle</option>
                    <option>Static Circle</option>
                    <option>Static Triangle</option>
                    <option>Dynamic Rectangle</option>
                    <option>Dynamic Circle</option>
                    <option>Dynamic Triangle</option>
                    <option>Left Flip</option>
                    <option>Right Flip</option>
                </select>
                <span class="input-group-btn">
                    <button id="generate" class="btn btn-default" type="button">
                        <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span>
                    </button>
                </span>
            </div>
        </div>
    </div>
    <div id="panel" class="row">
        <div class="col-md-2 control-button-col">
            <button id="info" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
            </button>
            <button id="cw" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span>
            </button>
            <button id="ccw" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-repeat icon-flipped" aria-hidden="true"></span>
            </button>
            <button id="delete" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
            </button>
        </div>
        <div id="info_panel" class="panel panel-default col-md-10 control-panel-col">
            <div class="panel-heading">
                <div class="input-group">
                    <span class="input-group-addon">Opacity</span>
                    <input id="input-opacity" type="number" min="0" max="100" value="100" class="form-control" >
                </div>
            </div>
            <div class="panel-body">
                <div class="input-group">
                    <span class="input-group-addon">Density</span>
                    <input id="input-density" type="number" min="0" max="100" value="10" class="form-control" >
                </div>
                <div class="input-group">
                    <span class="input-group-addon">Friction</span>
                    <input id="input-friction" type="number" min="0" max="100" value="5" class="form-control" >
                </div>
                <div class="input-group" id="key_bind_panel">
                    <span class="input-group-btn">
                        <button id="bind" class="btn btn-default" type="button">Bind Key</button>
                    </span>
                    <input id="input_key" type="text" class="form-control" placeholder="Enter a key to bind...">
                </div>
            </div>
        </div>

    </div>

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/Box2d.min.js"></script>
    <script src="js/Draggable.js"></script>
    <script src="js/ConstructBlock.js"></script>
    <script src="js/Panel.js"></script>
    <script src="js/GenerateBlock.js"></script>
    <script>
        window.requestAnimFrame = (function(){
            return window.requestAnimationFrame       ||
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame    ||
                    window.oRequestAnimationFrame      ||
                    window.msRequestAnimationFrame     ||
                    function(/* function */ callback, /* DOMElement */ element){
                        window.setTimeout(callback, 1000 / 60);
                    };
        })();

        var world;

        function init() {
            world = new b2World(
                    new b2Vec2(0, 10)    //gravity
                    ,  true                 //allow sleep
            );

            var fixDef = new b2FixtureDef;
            fixDef.density = 1.0;
            fixDef.friction = 0.5;
            fixDef.restitution = 0.2;

            var bodyDef = new b2BodyDef;

            //create ground
            bodyDef.type = b2Body.b2_staticBody;

            // positions the center of the object (not upper left!)
            bodyDef.position.x = canvas.width / 2 / SCALE;
            bodyDef.position.y = canvas.height / SCALE;

            fixDef.shape = new b2PolygonShape;

            // half width, half height. eg actual height here is 1 unit
            fixDef.shape.SetAsBox((600 / SCALE) / 2, (10/SCALE) / 2);
            world.CreateBody(bodyDef).CreateFixture(fixDef);

            //create some objects
//            var json = JSON.stringify(draggableImageArray);
//            console.log(json);
//            draggableImageArray = JSON.parse(json);
//            console.log(draggableImageArray);
            for (var i = 0; i < draggableImageArray.length; i++) {
                draggableImageArray[i].createBox2dObjectInWorld(world);
            }

            //setup debug draw
            var debugDraw = new b2DebugDraw();
            debugDraw.SetSprite(ctx);
            debugDraw.SetDrawScale(SCALE);
            debugDraw.SetFillAlpha(0.3);
            debugDraw.SetLineThickness(1.0);
            debugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);
            world.SetDebugDraw(debugDraw);

        }; // init()

        function update() {
            world.Step(
                    1 / 60   //frame-rate
                    ,  10       //velocity iterations
                    ,  10       //position iterations
            );
            world.DrawDebugData();
            world.ClearForces();

            requestAnimFrame(update);
        }; // update()

        $('#start').click(function(){
            init();
            requestAnimFrame(update);
            $('#panel').hide();
        });
    </script>
</body>
</html>