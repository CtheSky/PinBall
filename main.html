<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body {
            background-color: ivory;
            padding:10px;
        }

        #canvas {
            border:1px solid red;
        }

        #panel {
            position: absolute;
            z-index: 1;
            left: -999px;
            top: -999px;
        }
    </style>
</head>
<body>
    <p>Test produce box2d rectangle <button id="start">start</button></p>
    <canvas id="canvas" width=800 height=400></canvas>
    <div id="panel" >
        <button id="cw">cw</button>
        <button id="ccw">ccw</button>
    </div>

    <script src="js/jquery.min.js"></script>
    <script src="js/Box2d.min.js"></script>
    <script src="js/Draggable.js"></script>
    <script src="js/ConstructBlock.js"></script>
    <script>
        var dynamicSquare = new DynamicSquare({
            imageSrc: 'img/dynamicSquare.png',
            imageX: 620,
            imageY: 20,
            imageWidth: 50,
            imageHeight: 50
        });
        var dynamicSquare2 = new DynamicSquare({
            imageSrc: 'img/dynamicSquare.png',
            imageX: 700,
            imageY: 20,
            imageWidth: 50,
            imageHeight: 50
        });
        var staticSquare = new StaticSquare({
            imageSrc: 'img/staticSquare.png',
            imageX: 620,
            imageY: 100,
            imageWidth: 50,
            imageHeight: 50
        });
        var staticSquare2 = new StaticSquare({
            imageSrc: 'img/staticSquare.png',
            imageX: 700,
            imageY: 100,
            imageWidth: 50,
            imageHeight: 50
        });
        var dynamicCircle = new DynamicCircle({
            imageSrc: 'img/dynamicCircle.png',
            imageX: 620,
            imageY: 180,
            imageWidth: 50,
            imageHeight: 50
        });
        var staticCircle = new StaticCircle({
            imageSrc: 'img/staticCircle.png',
            imageX: 700,
            imageY: 180,
            imageWidth: 50,
            imageHeight: 50
        });
        var dynamicTriangle = new DynamicTriangle({
            imageSrc: 'img/dynamicTriangle.png',
            imageX: 620,
            imageY: 260,
            imageWidth: 50,
            imageHeight: 50
        });
        var staticTriangle = new StaticTriangle({
            imageSrc: 'img/staticTriangle.png',
            imageX: 700,
            imageY: 260,
            imageWidth: 50,
            imageHeight: 50
        });
        draggableImageArray.push(dynamicSquare);
        draggableImageArray.push(dynamicSquare2);
        draggableImageArray.push(staticSquare);
        draggableImageArray.push(staticSquare2);
        draggableImageArray.push(dynamicCircle);
        draggableImageArray.push(staticCircle);
        draggableImageArray.push(dynamicTriangle);
        draggableImageArray.push(staticTriangle);


        window.requestAnimFrame = (function(){
            return window.requestAnimationFrame       ||
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame    ||
                    window.oRequestAnimationFrame      ||
                    window.msRequestAnimationFrame     ||
                    function(/* function */ callback, /* DOMElement */ element){
                        window.setTimeout(callback, 1000 / 60);
                    };
        })();

        var world;

        function init() {
            world = new b2World(
                    new b2Vec2(0, 10)    //gravity
                    ,  true                 //allow sleep
            );

            var fixDef = new b2FixtureDef;
            fixDef.density = 1.0;
            fixDef.friction = 0.5;
            fixDef.restitution = 0.2;

            var bodyDef = new b2BodyDef;

            //create ground
            bodyDef.type = b2Body.b2_staticBody;

            // positions the center of the object (not upper left!)
            bodyDef.position.x = canvas.width / 2 / SCALE;
            bodyDef.position.y = canvas.height / SCALE;

            fixDef.shape = new b2PolygonShape;

            // half width, half height. eg actual height here is 1 unit
            fixDef.shape.SetAsBox((600 / SCALE) / 2, (10/SCALE) / 2);
            world.CreateBody(bodyDef).CreateFixture(fixDef);

            //create some objects
            for (var i = 0; i < draggableImageArray.length; i++) {
                draggableImageArray[i].createBox2dObjectInWorld(world);
            }

            //setup debug draw
            var debugDraw = new b2DebugDraw();
            debugDraw.SetSprite(ctx);
            debugDraw.SetDrawScale(SCALE);
            debugDraw.SetFillAlpha(0.3);
            debugDraw.SetLineThickness(1.0);
            debugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);
            world.SetDebugDraw(debugDraw);

        }; // init()

        function update() {
            world.Step(
                    1 / 60   //frame-rate
                    ,  10       //velocity iterations
                    ,  10       //position iterations
            );
            world.DrawDebugData();
            world.ClearForces();

            requestAnimFrame(update);
        }; // update()

        $('#start').click(function(){
            init();
            requestAnimFrame(update);
        });
    </script>
</body>
</html>